"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[4977],{6989(n,i,e){e.r(i),e.d(i,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"architecture/implementation-guide","title":"Implementation Guide","description":"Version: v6.1 \u2014 Repository-Aligned Edition","source":"@site/../docs/architecture/implementation-guide.md","sourceDirName":"architecture","slug":"/architecture/implementation-guide","permalink":"/architecture/implementation-guide","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Implementation Guide"},"sidebar":"docsSidebar","previous":{"title":"Execution Authority vs Agent Memory vs Runtime","permalink":"/architecture/execution-authority-vs-agent-memory"},"next":{"title":"Policy vs Authority","permalink":"/governance/policy-vs-authority"}}');var s=e(4848),l=e(8453);const t={title:"Implementation Guide"},o="Enterprise-Grade Engineering Implementation Guide",c={},d=[{value:"<strong>Version: v6.1 \u2014 Repository-Aligned Edition</strong>",id:"version-v61--repository-aligned-edition",level:2},{value:"<strong>2.1 Control Plane Language</strong>",id:"21-control-plane-language",level:2},{value:"<strong>2.2 Workflow Runtime</strong>",id:"22-workflow-runtime",level:2},{value:"<strong>2.3 Policy Engine</strong>",id:"23-policy-engine",level:2},{value:"<strong>2.4 APIs</strong>",id:"24-apis",level:2},{value:"<strong>2.5 Datastores</strong>",id:"25-datastores",level:2},{value:"<strong>2.6 Infrastructure</strong>",id:"26-infrastructure",level:2},{value:"<strong>3.1 Core Execution Plane</strong>",id:"31-core-execution-plane",level:2},{value:"<strong>3.2 Internal Packages</strong>",id:"32-internal-packages",level:2},{value:"<strong>3.3 Shared Packages</strong>",id:"33-shared-packages",level:2},{value:"<strong>3.4 Testing</strong>",id:"34-testing",level:2},{value:"<strong>4.1 ExecutionInstance</strong>",id:"41-executioninstance",level:2},{value:"<strong>4.2 AuthorityDecision</strong>",id:"42-authoritydecision",level:2},{value:"<strong>4.3 CommitmentArtifact</strong>",id:"43-commitmentartifact",level:2},{value:"<strong>7.1 Invocation</strong>",id:"71-invocation",level:2},{value:"<strong>7.2 Version Binding</strong>",id:"72-version-binding",level:2},{value:"<strong>8.1 Atomicity</strong>",id:"81-atomicity",level:2},{value:"<strong>8.2 Hash Chain Model</strong>",id:"82-hash-chain-model",level:2},{value:"<strong>8.3 Artifact Storage</strong>",id:"83-artifact-storage",level:2}];function a(n){const i={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"enterprise-grade-engineering-implementation-guide",children:(0,s.jsx)(i.strong,{children:"Enterprise-Grade Engineering Implementation Guide"})})}),"\n",(0,s.jsx)(i.h2,{id:"version-v61--repository-aligned-edition",children:(0,s.jsx)(i.strong,{children:"Version: v6.1 \u2014 Repository-Aligned Edition"})}),"\n",(0,s.jsxs)(i.p,{children:["Status: Authoritative Engineering Implementation Guide",(0,s.jsx)(i.br,{}),"\n","Audience:",(0,s.jsx)(i.br,{}),"\n","\u2022 Core maintainers",(0,s.jsx)(i.br,{}),"\n","\u2022 AI coding assistants",(0,s.jsx)(i.br,{}),"\n","\u2022 Platform engineers & SREs",(0,s.jsx)(i.br,{}),"\n","\u2022 Security reviewers",(0,s.jsx)(i.br,{}),"\n","\u2022 Enterprise design partners"]}),"\n",(0,s.jsx)(i.p,{children:"This guide operationalizes the Gantral TRD and Implementation Paper."}),"\n",(0,s.jsx)(i.p,{children:"If this guide conflicts with the TRD, the TRD prevails."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"0-governing-rules-non-negotiable",children:(0,s.jsx)(i.strong,{children:"0. Governing Rules (Non-Negotiable)"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Fail-closed behavior is mandatory"}),"\n",(0,s.jsx)(i.li,{children:"All authority transitions must be deterministic"}),"\n",(0,s.jsx)(i.li,{children:"Authority transitions and artifact emission must be atomic"}),"\n",(0,s.jsx)(i.li,{children:"Policy engines are advisory only"}),"\n",(0,s.jsx)(i.li,{children:"Logs are never admissible evidence"}),"\n",(0,s.jsx)(i.li,{children:"Replay must require only artifacts"}),"\n",(0,s.jsx)(i.li,{children:"No execution may advance past governed states without artifact persistence"}),"\n",(0,s.jsx)(i.li,{children:"If behavior is ambiguous, execution must stop"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Gantral is correctness-first infrastructure."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"1-implementation-objectives",children:(0,s.jsx)(i.strong,{children:"1. Implementation Objectives"})}),"\n",(0,s.jsx)(i.p,{children:"The implementation MUST ensure:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsx)(i.li,{children:"Policy thresholds are externalized from workflow code"}),"\n",(0,s.jsx)(i.li,{children:"Authority is canonical workflow state"}),"\n",(0,s.jsx)(i.li,{children:"workflow_version_id and policy_version_id are bound at decision time"}),"\n",(0,s.jsx)(i.li,{children:"Commitment artifacts form a recursive tamper-evident hash chain"}),"\n",(0,s.jsx)(i.li,{children:"Replay is independent of runtime, database, and logs"}),"\n",(0,s.jsx)(i.li,{children:"Human authority produces attributable reasoning"}),"\n",(0,s.jsx)(i.li,{children:"Policy updates do not require workflow redeployment"}),"\n",(0,s.jsx)(i.li,{children:"Authority visibility is unified across instances"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Operational efficiency and admissibility are equal goals."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"2-technology-stack-mandatory",children:(0,s.jsx)(i.strong,{children:"2. Technology Stack (Mandatory)"})}),"\n",(0,s.jsx)(i.h2,{id:"21-control-plane-language",children:(0,s.jsx)(i.strong,{children:"2.1 Control Plane Language"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Go (required)"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Reason:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Deterministic concurrency"}),"\n",(0,s.jsx)(i.li,{children:"Strong typing"}),"\n",(0,s.jsx)(i.li,{children:"Mature Temporal SDK"}),"\n",(0,s.jsx)(i.li,{children:"Enterprise readiness"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"22-workflow-runtime",children:(0,s.jsx)(i.strong,{children:"2.2 Workflow Runtime"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Temporal (required)"}),"\n",(0,s.jsx)(i.li,{children:"One workflow per execution instance"}),"\n",(0,s.jsx)(i.li,{children:"Deterministic replay enabled"}),"\n",(0,s.jsx)(i.li,{children:"No non-deterministic logic inside workflow definitions"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"23-policy-engine",children:(0,s.jsx)(i.strong,{children:"2.3 Policy Engine"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Open Policy Agent (OPA)"}),"\n",(0,s.jsx)(i.li,{children:"Policies authored in Rego"}),"\n",(0,s.jsx)(i.li,{children:"Sidecar or service mode"}),"\n",(0,s.jsx)(i.li,{children:"Policy bundles versioned independently"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Policy is advisory only."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"24-apis",children:(0,s.jsx)(i.strong,{children:"2.4 APIs"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"REST (server)"}),"\n",(0,s.jsx)(i.li,{children:"gRPC (internal where applicable)"}),"\n",(0,s.jsx)(i.li,{children:"OpenAPI-compatible external definitions"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"25-datastores",children:(0,s.jsx)(i.strong,{children:"2.5 Datastores"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"PostgreSQL \u2192 metadata and indices (non-authoritative)"}),"\n",(0,s.jsx)(i.li,{children:"Object storage \u2192 commitment artifacts (authoritative)"}),"\n",(0,s.jsxs)(i.li,{children:["Local artifact storage (",(0,s.jsx)(i.code,{children:"local-storage/artifacts"}),") for development only"]}),"\n",(0,s.jsx)(i.li,{children:"Redis (optional, non-authoritative)"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"26-infrastructure",children:(0,s.jsx)(i.strong,{children:"2.6 Infrastructure"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Kubernetes"}),"\n",(0,s.jsx)(i.li,{children:"Helm (recommended)"}),"\n",(0,s.jsx)(i.li,{children:"CI via GitHub Actions"}),"\n",(0,s.jsx)(i.li,{children:"Signed builds recommended"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"3-repository-structure-authoritative-layout",children:(0,s.jsx)(i.strong,{children:"3. Repository Structure (Authoritative Layout)"})}),"\n",(0,s.jsx)(i.p,{children:"The current repository layout is compliant and structured as follows:"}),"\n",(0,s.jsx)(i.h2,{id:"31-core-execution-plane",children:(0,s.jsx)(i.strong,{children:"3.1 Core Execution Plane"})}),"\n",(0,s.jsxs)(i.p,{children:["/gantral",(0,s.jsx)(i.br,{}),"\n","/cmd",(0,s.jsx)(i.br,{}),"\n","/server",(0,s.jsx)(i.br,{}),"\n","/worker",(0,s.jsx)(i.br,{}),"\n","/gantral-verify",(0,s.jsx)(i.br,{}),"\n","/gantral-demo",(0,s.jsx)(i.br,{}),"\n","/migrate",(0,s.jsx)(i.br,{}),"\n","/core",(0,s.jsx)(i.br,{}),"\n","/activities",(0,s.jsx)(i.br,{}),"\n","/engine",(0,s.jsx)(i.br,{}),"\n","/errors",(0,s.jsx)(i.br,{}),"\n","/policy",(0,s.jsx)(i.br,{}),"\n","/ports",(0,s.jsx)(i.br,{}),"\n","/workflows",(0,s.jsx)(i.br,{}),"\n","/adapters",(0,s.jsx)(i.br,{}),"\n","/primary",(0,s.jsx)(i.br,{}),"\n","/secondary",(0,s.jsx)(i.br,{}),"\n","/infra",(0,s.jsx)(i.br,{}),"\n","/db",(0,s.jsx)(i.br,{}),"\n","/migrations",(0,s.jsx)(i.br,{}),"\n","/gantral_artifacts"]}),"\n",(0,s.jsxs)(i.p,{children:["Core logic MUST remain inside ",(0,s.jsx)(i.code,{children:"/core"}),"."]}),"\n",(0,s.jsx)(i.p,{children:"Adapters MUST contain no business logic."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"32-internal-packages",children:(0,s.jsx)(i.strong,{children:"3.2 Internal Packages"})}),"\n",(0,s.jsxs)(i.p,{children:["/internal",(0,s.jsx)(i.br,{}),"\n","/artifact",(0,s.jsx)(i.br,{}),"\n","/auth",(0,s.jsx)(i.br,{}),"\n","/authority",(0,s.jsx)(i.br,{}),"\n","/middleware",(0,s.jsx)(i.br,{}),"\n","/policy",(0,s.jsx)(i.br,{}),"\n","/replay",(0,s.jsx)(i.br,{}),"\n","/storage",(0,s.jsx)(i.br,{}),"\n","/workflow"]}),"\n",(0,s.jsx)(i.p,{children:"All authority semantics must reside inside:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"/internal/authority"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"/internal/artifact"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"/internal/replay"})}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"33-shared-packages",children:(0,s.jsx)(i.strong,{children:"3.3 Shared Packages"})}),"\n",(0,s.jsxs)(i.p,{children:["/pkg",(0,s.jsx)(i.br,{}),"\n","/config",(0,s.jsx)(i.br,{}),"\n","/constants",(0,s.jsx)(i.br,{}),"\n","/logger",(0,s.jsx)(i.br,{}),"\n","/models",(0,s.jsx)(i.br,{}),"\n","/verifier"]}),"\n",(0,s.jsx)(i.p,{children:"Verifier logic MUST remain independent of runtime."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"34-testing",children:(0,s.jsx)(i.strong,{children:"3.4 Testing"})}),"\n",(0,s.jsxs)(i.p,{children:["/tests",(0,s.jsx)(i.br,{}),"\n","/unit",(0,s.jsx)(i.br,{}),"\n","/statemachine",(0,s.jsx)(i.br,{}),"\n","/artifact",(0,s.jsx)(i.br,{}),"\n","/replay",(0,s.jsx)(i.br,{}),"\n","/integration",(0,s.jsx)(i.br,{}),"\n","/golden",(0,s.jsx)(i.br,{}),"\n","/helpers"]}),"\n",(0,s.jsx)(i.p,{children:"Golden tests must validate artifact chain stability."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"4-core-domain-models",children:(0,s.jsx)(i.strong,{children:"4. Core Domain Models"})}),"\n",(0,s.jsx)(i.h2,{id:"41-executioninstance",children:(0,s.jsx)(i.strong,{children:"4.1 ExecutionInstance"})}),"\n",(0,s.jsx)(i.p,{children:"Fields:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"instance_id (UUID, immutable)"}),"\n",(0,s.jsx)(i.li,{children:"workflow_id"}),"\n",(0,s.jsx)(i.li,{children:"workflow_version_id"}),"\n",(0,s.jsx)(i.li,{children:"owning_team_id"}),"\n",(0,s.jsx)(i.li,{children:"current_state"}),"\n",(0,s.jsx)(i.li,{children:"created_at"}),"\n",(0,s.jsx)(i.li,{children:"terminated_at"}),"\n",(0,s.jsx)(i.li,{children:"cost_metadata"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Instances are append-only in state progression."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"42-authoritydecision",children:(0,s.jsx)(i.strong,{children:"4.2 AuthorityDecision"})}),"\n",(0,s.jsx)(i.p,{children:"Fields:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"decision_id"}),"\n",(0,s.jsx)(i.li,{children:"instance_id"}),"\n",(0,s.jsx)(i.li,{children:"decision_type (APPROVE / REJECT / OVERRIDE)"}),"\n",(0,s.jsx)(i.li,{children:"human_actor_id"}),"\n",(0,s.jsx)(i.li,{children:"role"}),"\n",(0,s.jsx)(i.li,{children:"justification"}),"\n",(0,s.jsx)(i.li,{children:"context_snapshot_hash"}),"\n",(0,s.jsx)(i.li,{children:"timestamp"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Rules:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"justification MUST be non-empty for APPROVE and OVERRIDE unless configured otherwise"}),"\n",(0,s.jsx)(i.li,{children:"identity must be validated via OIDC before persistence"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"43-commitmentartifact",children:(0,s.jsx)(i.strong,{children:"4.3 CommitmentArtifact"})}),"\n",(0,s.jsx)(i.p,{children:"Fields:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"artifact_version"}),"\n",(0,s.jsx)(i.li,{children:"artifact_id"}),"\n",(0,s.jsx)(i.li,{children:"instance_id"}),"\n",(0,s.jsx)(i.li,{children:"workflow_version_id"}),"\n",(0,s.jsx)(i.li,{children:"prev_artifact_hash"}),"\n",(0,s.jsx)(i.li,{children:"authority_state"}),"\n",(0,s.jsx)(i.li,{children:"policy_version_id"}),"\n",(0,s.jsx)(i.li,{children:"context_snapshot_hash"}),"\n",(0,s.jsx)(i.li,{children:"human_actor_id"}),"\n",(0,s.jsx)(i.li,{children:"justification"}),"\n",(0,s.jsx)(i.li,{children:"timestamp"}),"\n",(0,s.jsx)(i.li,{children:"artifact_hash"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Artifact MUST bind:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"workflow version"}),"\n",(0,s.jsx)(i.li,{children:"policy version"}),"\n",(0,s.jsx)(i.li,{children:"authority state"}),"\n",(0,s.jsx)(i.li,{children:"identity"}),"\n",(0,s.jsx)(i.li,{children:"authority-relevant context"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"5-authority-state-machine-executable-rules",children:(0,s.jsx)(i.strong,{children:"5. Authority State Machine (Executable Rules)"})}),"\n",(0,s.jsx)(i.p,{children:"Allowed transitions ONLY:"}),"\n",(0,s.jsxs)(i.p,{children:["CREATED \u2192 RUNNING",(0,s.jsx)(i.br,{}),"\n","RUNNING \u2192 WAITING_FOR_HUMAN",(0,s.jsx)(i.br,{}),"\n","WAITING_FOR_HUMAN \u2192 APPROVED",(0,s.jsx)(i.br,{}),"\n","WAITING_FOR_HUMAN \u2192 REJECTED",(0,s.jsx)(i.br,{}),"\n","WAITING_FOR_HUMAN \u2192 OVERRIDDEN",(0,s.jsx)(i.br,{}),"\n","APPROVED \u2192 RESUMED",(0,s.jsx)(i.br,{}),"\n","OVERRIDDEN \u2192 RESUMED",(0,s.jsx)(i.br,{}),"\n","RESUMED \u2192 RUNNING",(0,s.jsx)(i.br,{}),"\n","RUNNING \u2192 COMPLETED",(0,s.jsx)(i.br,{}),"\n","RUNNING \u2192 TERMINATED"]}),"\n",(0,s.jsx)(i.p,{children:"Any other transition MUST panic and terminate execution."}),"\n",(0,s.jsx)(i.p,{children:"No implicit recovery allowed."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"6-temporal-workflow-implementation",children:(0,s.jsx)(i.strong,{children:"6. Temporal Workflow Implementation"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"One Temporal workflow per execution instance"}),"\n",(0,s.jsx)(i.li,{children:"Workflow history authoritative only for ordering"}),"\n",(0,s.jsx)(i.li,{children:"All authority decisions recorded as workflow events"}),"\n",(0,s.jsx)(i.li,{children:"No random values"}),"\n",(0,s.jsx)(i.li,{children:"No wall-clock calls"}),"\n",(0,s.jsx)(i.li,{children:"No external I/O inside workflow logic"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Activities handle external side effects."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"7-policy-evaluation-opa",children:(0,s.jsx)(i.strong,{children:"7. Policy Evaluation (OPA)"})}),"\n",(0,s.jsx)(i.h2,{id:"71-invocation",children:(0,s.jsx)(i.strong,{children:"7.1 Invocation"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Invoked synchronously during transition guard"}),"\n",(0,s.jsx)(i.li,{children:"Input schema must be versioned"}),"\n",(0,s.jsx)(i.li,{children:"OPA output: ALLOW / REQUIRE_HUMAN / DENY"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"72-version-binding",children:(0,s.jsx)(i.strong,{children:"7.2 Version Binding"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"policy_version_id must be retrieved from bundle"}),"\n",(0,s.jsx)(i.li,{children:"policy_version_id must be embedded in artifact"}),"\n",(0,s.jsx)(i.li,{children:"Policy changes must not require workflow redeployment"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Policy never commits authority."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"8-commitment-artifact-emission",children:(0,s.jsx)(i.strong,{children:"8. Commitment Artifact Emission"})}),"\n",(0,s.jsx)(i.h2,{id:"81-atomicity",children:(0,s.jsx)(i.strong,{children:"8.1 Atomicity"})}),"\n",(0,s.jsx)(i.p,{children:"Authority transition and artifact emission MUST be atomic."}),"\n",(0,s.jsx)(i.p,{children:"If artifact persistence fails:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"State MUST NOT advance"}),"\n",(0,s.jsx)(i.li,{children:"Workflow MUST remain in WAITING_FOR_HUMAN"}),"\n",(0,s.jsx)(i.li,{children:"No retry loops"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"82-hash-chain-model",children:(0,s.jsx)(i.strong,{children:"8.2 Hash Chain Model"})}),"\n",(0,s.jsx)(i.p,{children:"artifact_hash_i ="}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"H(payload_i) if first artifact"}),"\n",(0,s.jsx)(i.li,{children:"H(payload_i || artifact_hash_{i-1}) otherwise"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Modification of any artifact invalidates subsequent chain."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"83-artifact-storage",children:(0,s.jsx)(i.strong,{children:"8.3 Artifact Storage"})}),"\n",(0,s.jsx)(i.p,{children:"Production:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Append-only object storage"}),"\n",(0,s.jsx)(i.li,{children:"Write-once configuration"}),"\n",(0,s.jsx)(i.li,{children:"No mutation APIs"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Development:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"local-storage/artifacts (non-authoritative)"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"gantral_artifacts"})," directory must not allow mutation in production mode."]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"9-replay--verification",children:(0,s.jsx)(i.strong,{children:"9. Replay & Verification"})}),"\n",(0,s.jsx)(i.p,{children:"Verifier location:"}),"\n",(0,s.jsxs)(i.p,{children:["/pkg/verifier",(0,s.jsx)(i.br,{}),"\n","/cmd/gantral-verify"]}),"\n",(0,s.jsx)(i.p,{children:"Verifier MUST:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Operate offline"}),"\n",(0,s.jsx)(i.li,{children:"Require no network"}),"\n",(0,s.jsx)(i.li,{children:"Accept artifact file(s)"}),"\n",(0,s.jsx)(i.li,{children:"Output VALID / INVALID / INCONCLUSIVE"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Replay validates:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsx)(i.li,{children:"Hash integrity"}),"\n",(0,s.jsx)(i.li,{children:"Transition validity"}),"\n",(0,s.jsx)(i.li,{children:"workflow_version_id consistency"}),"\n",(0,s.jsx)(i.li,{children:"policy_version_id consistency"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Replay reconstructs authority-state projection only."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"10-failure-semantics",children:(0,s.jsx)(i.strong,{children:"10. Failure Semantics"})}),"\n",(0,s.jsx)(i.p,{children:"Terminate execution on:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Missing artifact"}),"\n",(0,s.jsx)(i.li,{children:"Hash mismatch"}),"\n",(0,s.jsx)(i.li,{children:"Illegal transition"}),"\n",(0,s.jsx)(i.li,{children:"Identity ambiguity"}),"\n",(0,s.jsx)(i.li,{children:"Policy ambiguity"}),"\n",(0,s.jsx)(i.li,{children:"Version mismatch"}),"\n",(0,s.jsx)(i.li,{children:"Temporal non-determinism"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Fail closed always."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"11-identity--security",children:(0,s.jsx)(i.strong,{children:"11. Identity & Security"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"OIDC federation only"}),"\n",(0,s.jsx)(i.li,{children:"No local users"}),"\n",(0,s.jsx)(i.li,{children:"No password storage"}),"\n",(0,s.jsx)(i.li,{children:"No secret persistence"}),"\n",(0,s.jsx)(i.li,{children:"Workload identity required"}),"\n",(0,s.jsx)(i.li,{children:"Artifact emission only after identity validation"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"12-operational-efficiency-requirements",children:(0,s.jsx)(i.strong,{children:"12. Operational Efficiency Requirements"})}),"\n",(0,s.jsx)(i.p,{children:"Implementation MUST:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Prevent governance logic inside workflow code"}),"\n",(0,s.jsx)(i.li,{children:"Externalize approval thresholds"}),"\n",(0,s.jsx)(i.li,{children:"Avoid workflow forks based solely on thresholds"}),"\n",(0,s.jsx)(i.li,{children:"Allow policy bundle updates without redeploying workflows"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"This reduces:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Code duplication"}),"\n",(0,s.jsx)(i.li,{children:"Redeployment risk"}),"\n",(0,s.jsx)(i.li,{children:"Governance drift"}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"13-unified-authority-visibility",children:(0,s.jsx)(i.strong,{children:"13. Unified Authority Visibility"})}),"\n",(0,s.jsx)(i.p,{children:"System MUST provide:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Queryable execution instances"}),"\n",(0,s.jsx)(i.li,{children:"Visible WAITING_FOR_HUMAN states"}),"\n",(0,s.jsx)(i.li,{children:"Instance-level isolation"}),"\n",(0,s.jsx)(i.li,{children:"Historical authority progression"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"No hidden execution state allowed."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"14-testing-requirements",children:(0,s.jsx)(i.strong,{children:"14. Testing Requirements"})}),"\n",(0,s.jsx)(i.p,{children:"Mandatory tests:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Transition correctness"}),"\n",(0,s.jsx)(i.li,{children:"Atomic artifact emission"}),"\n",(0,s.jsx)(i.li,{children:"Hash chain validation"}),"\n",(0,s.jsx)(i.li,{children:"Replay determinism"}),"\n",(0,s.jsx)(i.li,{children:"Version consistency"}),"\n",(0,s.jsx)(i.li,{children:"Fuzz tests for artifact corruption"}),"\n",(0,s.jsx)(i.li,{children:"Golden replay stability tests"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Replay compatibility cannot break without major version change."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"15-ai-coding-assistant-rules",children:(0,s.jsx)(i.strong,{children:"15. AI Coding Assistant Rules"})}),"\n",(0,s.jsx)(i.p,{children:"AI assistants MUST:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Implement only documented transitions"}),"\n",(0,s.jsx)(i.li,{children:"Never auto-approve"}),"\n",(0,s.jsx)(i.li,{children:"Never infer missing authority"}),"\n",(0,s.jsx)(i.li,{children:"Never embed policy logic in workflows"}),"\n",(0,s.jsx)(i.li,{children:"Fail on ambiguity"}),"\n",(0,s.jsx)(i.li,{children:"Preserve atomicity"}),"\n",(0,s.jsx)(i.li,{children:"Preserve version binding"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Correctness > convenience."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"16-enterprise-deployment-expectations",children:(0,s.jsx)(i.strong,{children:"16. Enterprise Deployment Expectations"})}),"\n",(0,s.jsx)(i.p,{children:"Production deployments should:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Enforce write-once artifact buckets"}),"\n",(0,s.jsx)(i.li,{children:"Separate runtime and control plane"}),"\n",(0,s.jsx)(i.li,{children:"Enable justification enforcement"}),"\n",(0,s.jsx)(i.li,{children:"Pin policy bundle versions"}),"\n",(0,s.jsx)(i.li,{children:"Monitor WAITING_FOR_HUMAN backlog"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Gantral must be incrementally adoptable."}),"\n",(0,s.jsx)(i.p,{children:"Agents do not require memory model modification."}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h1,{id:"17-final-statement",children:(0,s.jsx)(i.strong,{children:"17. Final Statement"})}),"\n",(0,s.jsx)(i.p,{children:"If implemented according to this guide:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Policy\u2013code duplication is eliminated"}),"\n",(0,s.jsx)(i.li,{children:"Authority becomes canonical state"}),"\n",(0,s.jsx)(i.li,{children:"Chain-of-custody becomes cryptographically verifiable"}),"\n",(0,s.jsx)(i.li,{children:"Replay is independent of logs"}),"\n",(0,s.jsx)(i.li,{children:"Operational fragmentation is structurally removed"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Gantral becomes deterministic execution infrastructure by construction."}),"\n",(0,s.jsx)(i.hr,{})]})}function h(n={}){const{wrapper:i}={...(0,l.R)(),...n.components};return i?(0,s.jsx)(i,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},8453(n,i,e){e.d(i,{R:()=>t,x:()=>o});var r=e(6540);const s={},l=r.createContext(s);function t(n){const i=r.useContext(l);return r.useMemo(function(){return"function"==typeof n?n(i):{...i,...n}},[i,n])}function o(n){let i;return i=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:t(n.components),r.createElement(l.Provider,{value:i},n.children)}}}]);